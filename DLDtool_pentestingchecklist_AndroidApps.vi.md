# Data Loss Detector: Tự động phát hiện lỗi mất dữ liệu trong ứng dụng Android
- Data Loss Detector (DLD) là một công cụ hoàn toàn tự động có khả năng phát hiện lỗi mất dữ liệu trong khi khám phá ứng dụng đang được thử nghiệm.
Công cụ này hoạt động thông qua dòng lệnh, trên cả hệ điều hành Windows và hệ điều hành Linux.
DLD khai thác [Droidbot](https://github.com/honeynet/droidbot), một công cụ tạo đầu vào thử nghiệm hiện đại dành cho ứng dụng Android, để gửi đến các chuỗi sự kiện thiết bị Android được kết nối mà qua đó công cụ này khám phá ứng dụng đang được thử nghiệm, tìm kiếm các sự cố mất dữ liệu có thể ảnh hưởng đến ứng dụng.
Cuối cùng, công cụ này tạo ra một báo cáo chi tiết có chứa thông tin về quá trình khám phá đã thực hiện và
các lỗi mất dữ liệu đã phát hiện, đồng thời cung cấp khả năng tái tạo chúng.

## Điều kiện tiên quyết
1) [Android SDK](https://developer.android.com/studio).

Đặt các biến môi trường sau:
- ANDROID_HOME
- Trên HĐH Linux, nó phải là */usr/lib/android-sdk*
- Trên HĐH Windows, nó phải là *C:/Users/<your_pc_name>/AppData/Local/Android/Sdk*
- TOOLS
- Trên HĐH Linux, nó phải là */usr/lib/android-sdk/tools*
- Trên HĐH Windows, nó phải là *C:/Users/<your_pc_name>/AppData/Local/Android/Sdk/tools*
- PLATFORM_TOOLS
- Trên HĐH Linux, nó phải là */usr/lib/android-sdk/platform-tools*
- Trên HĐH Windows, nó phải là *C:/Users/<your_pc_name>/AppData/Local/Android/Sdk/platform-tools*
- EMULATOR
- Trên HĐH Linux, nó phải là */usr/lib/android-sdk/emulator*
- Trên hệ điều hành Windows, nó phải là *C:/Users/<your_pc_name>/AppData/Local/Android/Sdk/emulator*

2) [Python](https://www.python.org/downloads/release/python-2716/) (phiên bản 2.7)

Trên hệ điều hành Windows, hãy đặt các biến môi trường sau:
- PYTHON
- Nó phải là *C:/Python27*
- PIP
- Nó phải là *C:/Python27/Scripts*

3) [Java 8](https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html).

Trên hệ điều hành Windows, hãy đặt biến môi trường sau:
- JAVA_HOME
- Biến này phải là *C:/Program Files/Java/jdk1.8.0_191/bin*

## Cách cài đặt
1) **cd DLD-tool**
2) **python installer.py -install** (để gỡ cài đặt DLD, hãy sử dụng tùy chọn **-uninstall**)
- Nếu installer.py không hoạt động, hãy cài đặt DLD theo cách thủ công:
  - **cd droidbot-tool**
  - **pip install -e .**
  - **cd ..**
  - **pip install -e .**
3) Kiểm tra xem đã cài đặt đúng chưa bằng cách nhập **dld -h** (sẽ xuất hiện các tùy chọn khác nhau)

## Cách sử dụng công cụ
DLD hoạt động thông qua dòng lệnh và chỉ yêu cầu tệp apk của ứng dụng để kiểm tra. Không cần phải ở trong thư mục DLD để khởi động công cụ. Có thể đặt thời gian thực hiện theo thời gian tính bằng giây hoặc số sự kiện được tạo.
1) Đảm bảo bạn đã mở và kết nối thiết bị Android qua ADB (kiểm tra bằng cách nhập **adb devices**)
2) Khởi chạy DLD bằng cách nhập **dld -a <appname.apk> -o <output_folder>**. Đây là lệnh cơ bản nhất để khởi động DLD bằng các thiết lập mặc định.
Có thể thêm một hoặc nhiều thiết lập tùy chỉnh:
 - **-is_emulator**: thêm tùy chọn này nếu bạn đang sử dụng Thiết bị ảo Android
 - **-scroll_full_down_y \<number\>**: tọa độ y trên màn hình mà DLD bắt đầu vuốt lên (mặc định là 1600)
 - **-main_activity <activity_name>**: hoạt động mà DLD sử dụng để khởi động ứng dụng. Đôi khi, DLD không lấy được hoạt động chính xác từ manifest.xml của ứng dụng. Ví dụ, trong ứng dụng "Bee Count", nó sử dụng *com.knirirr.beecount..WelcomeActivity* (có hai dấu chấm) thay vì *com.knirirr.beecount.WelcomeActivity* (có một dấu chấm).
Do đó, DLD sẽ không thể khởi động ứng dụng. Nếu điều này xảy ra, hãy chỉ định hoạt động chính xác bằng tùy chọn **-main_activity**. Ví dụ: *-main_activity com.knirirr.beecount.WelcomeActivity*
 - **-epsilon \<number\>**: giá trị từ 0,0 đến 1,0 (mặc định là 0,1). 0.0 ngụ ý một cuộc khám phá có hệ thống thuần túy trong khi 1.0
ngụ ý một cuộc khám phá hoàn toàn ngẫu nhiên
 - **-timeout \<number\>**: thời gian tính bằng giây được phân bổ cho việc thực thi
 - **-count \<number\>**: số sự kiện được tạo (mặc định là 2250)
 - **-interval \<number\>**: thời gian ngủ giữa các sự kiện (mặc định là 3 giây). Tăng giá trị này nếu thiết bị Android của bạn hoạt động chậm
 - **-script <your_script.json>**: chỉ định tập lệnh json để buộc DLD thực hiện các hành động cụ thể. Điều này hữu ích nếu ứng dụng yêu cầu, ví dụ, đăng nhập
 - **-grant_perm**: cấp tất cả các quyền mà ứng dụng yêu cầu (được khuyến nghị)
 - **-keep_app**: không gỡ cài đặt ứng dụng sau khi thực thi DLD
 - nhập **dld --help** hoặc **dld -h** để biết thêm chi tiết

## Cách đọc kết quả
DLD báo cáo tất cả thông tin vào *output_folder* (được chỉ định bằng tùy chọn *-o*). Trong thư mục này, DLD tạo tệp *report.html* chứa thông tin chi tiết về quá trình khám phá. Ngoài ra, DLD cung cấp thư mục *dataloss*, chứa tất cả các lỗi Mất dữ liệu được phát hiện trong quá trình thực thi chia theo hoạt động. Mỗi lỗi Mất dữ liệu được báo cáo bởi 3 tệp:
- year_month_day_hour_minute_second before.png, là ảnh chụp màn hình được chụp trước khi thay đổi hướng kép
- year_month_day_hour_minute_second after.png, là ảnh chụp màn hình được chụp sau khi thay đổi hướng kép
- year_month_day_hour_minute_second views.txt, chứa mô tả về các chế độ xem trước và sau khi thay đổi hướng kép

Lưu ý rằng có sự tương ứng giữa ngày phát hiện lỗi mất dữ liệu cụ thể bên trong *report.html* và tên của các tệp biểu thị lỗi đó.

## Cách phát lại lỗi mất dữ liệu được phát hiện trong lần khám phá trước
DLD cho phép tái tạo chuỗi sự kiện chính xác được tạo trong lần thực thi trước đó, để tái tạo lỗi mất dữ liệu được phát hiện.
Gõ **dld -a <appname.apk> -policy replay -replay_output <output_folder>** để khởi động DLD ở chế độ phát lại, tái tạo chuỗi sự kiện dẫn đến lỗi mất dữ liệu được phát hiện.
